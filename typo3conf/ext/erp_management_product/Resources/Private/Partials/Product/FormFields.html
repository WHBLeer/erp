<html 
	xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" 
    xmlns:sll="http://typo3.org/ns/Sll/Common/ViewHelpers"
	data-namespace-typo3-fluid="true">
<table class="table table-bordered mb-0">
	<tbody>
		<tr>
			<td>产品名称</td>
			<td>
				<f:form.textfield property="name" class="form-control" placeholder="商品名称" />
			</td>
		</tr>
		<tr>
			<td>产品编号</td>
			<td>
				<f:form.textfield property="numbering" class="form-control" placeholder="商品编号" id="numbering" />
				<input type="hidden" id="productUid" value="{product.uid}" />
			</td>
		</tr>
		<tr>
			<td>产品相册</td>
			<td>
				<div class="form-group">
                    <input id="bootstarp-fileupload" type="file" multiple class="file" data-overwrite-initial="false" data-min-file-count="2">
				</div>
				<f:form.hidden property="imageuids" id="imageuids"/>
			</td>
		</tr>
		<tr>
			<td>产品分类</td>
			<td>
				<input type="text" id="categoryValuetext" class="form-control" placeholder="产品分类" onclick="getCategory()" readonly value="{product.category.name}  {product.category.nameEn}"/>
				<f:form.hidden id="categoryValueid" name="category" value="{product.category.code}" />
			</td>
		</tr>
		<tr>
			<td>审核状态</td>
			<td>
				<f:for each="{approvals}" as="sh0" iteration="i">
					<label style="font-weight:normal;margin-right:20px">
						<f:form.radio name="approval" value="{sh0.uid}" checked="{f:if(condition: '{product.approval.uid}=={sh0.uid}', then: 'checked')}" />{sh0.name}
					</label>
				</f:for>
			</td>
		</tr>
		<tr>
			<td>上架状态</td>
			<td>
				<f:for each="{shelvess}" as="sh1" iteration="i">
					<label style="font-weight:normal;margin-right:20px">
						<f:form.radio name="shelves" value="{sh1.uid}" checked="{f:if(condition: '{product.shelves.uid}=={sh1.uid}', then: 'checked')}" />{sh1.name}
					</label>
				</f:for>
			</td>
		</tr>
		<tr>
			<td>商品类型</td>
			<td>
				<f:for each="{gettypes}" as="sh2" iteration="i">
					<label style="font-weight:normal;margin-right:20px">
						<f:form.radio name="gtypes" value="{sh2.uid}" checked="{f:if(condition: '{product.gtypes.uid}=={sh2.uid}', then: 'checked')}" />{sh2.name}
					</label>
				</f:for>
			</td>
		</tr>
		<tr>
			<td>商家信息</td>
			<td>
				<div class="row">
					<div class="col-md-10">
						<f:form.textfield id="businessurl" property="business" class="form-control" placeholder="商家信息主页链接" />
					</div>
					<div class="col-md-2">
						<a href="javascript:;" class="btn btn-info" onclick="showBusiness('businessurl');"><i class="ti-eye"></i> 查看</a>
					</div>
				</div>
				
			</td>
		</tr>
		<tr> 
			<td>产品信息</td>
			<td>
				<div class="form-inline">
					<div class="input-group">
						<div class="input-group-addon">厂商名称</div>
						<f:form.textfield name="info[tradeName]" class="form-control" style="border-color: red;" placeholder="建议填写" value="{product.info.tradeName}"/>
					</div>
					<div class="input-group">
						<div class="input-group-addon">品牌名称</div>
						<f:form.textfield name="info[brandName]" class="form-control" style="border-color: red;" placeholder="建议填写" value="{product.info.brandName}" />
					</div>
					<div class="input-group">
						<div class="input-group-addon">厂家编号</div>
						<f:form.textfield name="info[tradeNum]" class="form-control" style="border-color: red;" placeholder="建议填写" value="{product.info.tradeNum}" />
					</div>
					<div class="input-group">
						<div class="input-group-addon">内部SKU</div>
						<f:form.textfield id="piSku" name="info[sku]" class="form-control" placeholder="SKU" additionalAttributes="{oninput:'skuChange(this)'}" value="{product.info.sku}" />
					</div>
				</div>
				<div class="form-inline">
					<div class="input-group">
						<div class="input-group-addon">产品来源</div>
						<f:form.textfield name="info[source]" class="form-control" placeholder="1688,淘宝,天猫..."  value="{product.info.source}" />
					</div>
					<div class="input-group">
						<div class="input-group-addon">来源网址</div>
						<f:form.textfield type="url" name="info[link]" class="form-control" placeholder="产品来源链接:https:// http://" value="{product.info.link}" />
					</div>
					<div class="input-group">
						<div class="input-group-addon">产品码</div>
						<f:form.textfield type="text" name="info[code]" class="form-control" placeholder="UPC/EAN"  value="{product.info.code}"/>
					</div>
					<div class="input-group">
						<div class="input-group-addon">备注</div>
						<f:form.textfield type="text" name="info[remark]" class="form-control" placeholder="附加备注"  value="{product.info.remark}"/>
					</div>
				</div>
			</td>
		</tr>
		<tr>
			<td>成本运费</td>
			<td>
				<div class="form-inline">
					<div class="input-group ">
						<div class="input-group-addon">采购价:(¥)</div>
						<f:form.textfield name="cost[cg]" class="form-control" placeholder="采购价格" additionalAttributes="{oninput:'changePrice(1)',size:'12'}" value="{product.cost.cg}" />
					</div>
					<div class="input-group ">
						<div class="input-group-addon">重量:(kg)</div>
						<f:form.textfield name="cost[zl]" class="form-control" placeholder="产品重量" additionalAttributes="{oninput:'changePrice(0)',size:'12'}" value="{product.cost.zl}" />
					</div>
					<div class="input-group  ">
						<div class="input-group-addon">长:(cm)</div>
						<f:form.textfield name="cost[cc]" class="form-control" placeholder="长" additionalAttributes="{oninput:'changePrice(0)',size:'12'}" value="{product.cost.cc}" />
					</div>
					<div class="input-group  ">
						<div class="input-group-addon">宽:(cm)</div>
						<f:form.textfield name="cost[kd]" class="form-control" placeholder="宽" additionalAttributes="{oninput:'changePrice(0)',size:'12'}" value="{product.cost.kd}" />
					</div>
					<div class="input-group  ">
						<div class="input-group-addon">高:(cm)</div>
						<f:form.textfield name="cost[gd]" class="form-control" placeholder="高" additionalAttributes="{oninput:'changePrice(0)',size:'12'}" value="{product.cost.gd}" />
					</div>
				</div>
				<div class="form-inline">
					<div class="input-group">
						<div class="input-group-addon">国内运费:(¥)</div>
						<f:form.textfield id="piFreight" name="cost[yf]" class="form-control" placeholder="国内运费" additionalAttributes="{oninput:'changePrice(1)',size:'12'}" value="{product.cost.yf}" />
					</div>
					<div class="input-group">
						<div class="input-group-addon">折扣:(系数)</div>
						<f:form.textfield id="piDiscount" name="cost[zk]" class="form-control" placeholder="折扣系数" additionalAttributes="{oninput:'changePrice(1)',size:'12'}" value="{product.cost.zk}" />
					</div>
					<div class="input-group">
						<div class="input-group-addon">库存数量:</div>
						<f:form.textfield id="piQuantity" name="cost[sy]" class="form-control" additionalAttributes="{size:'12'}" value="{product.cost.sy}" />
					</div>
					<div class="input-group">
						<div class="input-group-addon">预处理时间:(天)</div>
						<f:form.textfield name="cost[sj]" class="form-control" additionalAttributes="{size:'10'}" value="{product.cost.sj}" placeholder="现货填 1"/>
					</div>
				</div>

				<table class="table table-condensed table-bordered" id="moneyType">
					<thead>
						<tr>
							<th>国家</th>
							<th>运费(￥)</th>
							<th>售价(￥)</th>
							<th>外币(？)</th>
							<th>最终(？)</th>
							<th>利润(￥)</th>
						</tr>
					</thead>
					<tbody align="center" id="priceTbody">
						<tr>
							<td>
								<span>美国</span>
								<input type="hidden" value="982322">
							</td>
							<td>
								<span>100.00</span>
							</td>
							<td>
								<span>422.92</span>
							</td>
							<td>
								<span>60.05</span>[USD]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-0" onchange="freChange(this)">
								<f:form.hidden id="piDiscount" name="cost[calculation][0]" />
							</td>
							<td>
								<span>219.92</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>加拿大</span>
								<input type="hidden" value="982323">
							</td>
							<td>
								<span>74.00</span>
							</td>
							<td>
								<span>368.75</span>
							</td>
							<td>
								<span>69.33</span>[CAD]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-1" onchange="freChange(this)">
								<f:form.hidden id="piUsprice" name="cost[calculation][1]" />
							</td>
							<td>
								<span>191.75</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>墨西哥</span>
								<input type="hidden" value="982324">
							</td>
							<td>
								<span>130.00</span>
							</td>
							<td>
								<span>485.42</span>
							</td>
							<td>
								<span>1328.10</span>[MXN]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-2" onchange="freChange(this)">
								<f:form.hidden id="piUsprice" name="cost[calculation][2]" />
							</td>
							<td>
								<span>252.42</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>英国</span>
								<input type="hidden" value="982325">
							</td>
							<td>
								<span>53.00</span>
							</td>
							<td>
								<span>325.00</span>
							</td>
							<td>
								<span>35.10</span>[GBP]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-3" onchange="freChange(this)">
								<f:form.hidden id="pricehid" name="cost[calculation][3]" />
							</td>
							<td>
								<span>169.00</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>法国</span>
								<input type="hidden" value="982326">
							</td>
							<td>
								<span>82.00</span>
							</td>
							<td>
								<span>385.42</span>
							</td>
							<td>
								<span>49.33</span>[EUR]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-4" onchange="freChange(this)">
								<f:form.hidden class="pricehid" name="cost[calculation][4]" />
							</td>
							<td>
								<span>200.42</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>德国</span>
								<input type="hidden" value="982327">
							</td>
							<td>
								<span>65.00</span>
							</td>
							<td>
								<span>350.00</span>
							</td>
							<td>
								<span>44.80</span>[EUR]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-5" onchange="freChange(this)">
								<f:form.hidden class="pricehid" name="cost[calculation][5]" />
							</td>
							<td>
								<span>182.00</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>意大利</span>
								<input type="hidden" value="982328">
							</td>
							<td>
								<span>80.00</span>
							</td>
							<td>
								<span>381.25</span>
							</td>
							<td>
								<span>48.80</span>[EUR]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-6" onchange="freChange(this)">
								<f:form.hidden class="pricehid" name="cost[calculation][6]" />
							</td>
							<td>
								<span>198.25</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>西班牙</span>
								<input type="hidden" value="982329">
							</td>
							<td>
								<span>60.00</span>
							</td>
							<td>
								<span>339.58</span>
							</td>
							<td>
								<span>43.47</span>[EUR]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-7" onchange="freChange(this)">
								<f:form.hidden class="pricehid" name="cost[calculation][7]" />
							</td>
							<td>
								<span>176.58</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>日本</span>
								<input type="hidden" value="982330">
							</td>
							<td>
								<span>65.00</span>
							</td>
							<td>
								<span>350.00</span>
							</td>
							<td>
								<span>5404.00</span>[JPY]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-8" onchange="freChange(this)">
								<f:form.hidden class="pricehid" name="cost[calculation][8]" />
							</td>
							<td>
								<span>182.00</span>(<span>52.00%</span>)
							</td>
						</tr>
						<tr>
							<td>
								<span>澳大利亚</span>
								<input type="hidden" value="982331">
							</td>
							<td>
								<span>80.00</span>
							</td>
							<td>
								<span>381.25</span>
							</td>
							<td>
								<span>79.30</span>[AUD]
							</td>
							<td>
								<input type="text" class="form-control" id="calculation-9" onchange="freChange(this)">
								<f:form.hidden class="pricehid" name="cost[calculation][9]" />
							</td>
							<td>
								<span>198.25</span>(<span>52.00%</span>)
							</td>
						</tr>
					</tbody>
				</table>
			</td>
		</tr>
		<tr>
			<td>
				产品介绍
			</td>
			<td>
				<!-- 产品介绍 -->
				<f:render partial="Product/FormFieldsDesc" arguments="{_all}" />
			</td>
		</tr>
		<tr>
			<td>
				原始规格
			</td>
			<td>
				<div id="valuejx">
					<span>英规</span>
					<span>奥规</span>
					<span>美规</span>
					<span>欧规</span>
				</div>
				<input id="jx" type="hidden" value="{&quot;sku&quot;:{&quot;skuProps&quot;:[{&quot;prop&quot;:&quot;尺寸规格&quot;,&quot;value&quot;:[{&quot;name&quot;:&quot;英规&quot;},{&quot;name&quot;:&quot;奥规&quot;},{&quot;name&quot;:&quot;美规&quot;},{&quot;name&quot;:&quot;欧规&quot;}]}]}}">
			</td>
		</tr>
		<tr>
			<td>规格变体</td>
			<td>
				<div id="skuhead">
					<ul id="sku">
						<li>
							<span id="sku_name">变体参数(点击编辑)：</span>
						</li>
					</ul>
					<button style="" type="button" class="btn btn-success btn-sm" id="skuModalLabel"onclick="addVariant()">添加</button>
					<div>
						<ul id="valueli">
						</ul>
					</div>
				</div>
				<button class="btn btn-success btn-sm" type="button" onclick="tipImg(this)"
				id="imgChooseBtn">图片选择</button>
				<button class="btn btn-success btn-sm" type="button" onclick="deleC(this)">删除变体</button>
				<table id="vtable" class="table">
					<thead>
						<tr>
							<th style="width: 2%"><input id="ckx" onclick="oclickAllChecked(this)" type="checkbox"></th>
							<th style="width: 4%">序号</th>
							<th style="width: 8%">组合</th>
							<th style="width: 8%">SKU修正</th>
							<th style="width: 6%">加价</th>
							<th style="width: 6%">库存</th>
							<th style="width: 10%">UPC/EAN</th>
							<th style="width: 56%">已选图片</th>
						</tr>
					</thead>
					<tbody id="tbAdd">
					</tbody>
				</table>
			</td>
		</tr>
	</tbody>
</table>
<div id="imgdisplay" style="display: none;" class=""></div>
<script>
	//定义图片展示参数
	<f:format.raw><sll:viewAndDelSetting uids="{product.imageuids}" /></f:format.raw>
	var fileurl = '{fileurl}';

	//获取商品类别
	function getCategory(){
		layer.open({
			type : 2,
			title : '商品类别',
			maxmin : true,
			shadeClose : false, 
			area : [ '800px', '620px' ],
			content :  '/api/getcategory',
		});
	}

	//访问产品主页
	function showBusiness(id) {
		link = $("#"+id).val();
		window.open(link);
	}

	// 添加变体
	function addVariant(){
		layer.open({
			type : 2,
			title : '变体',
			maxmin : true,
			shadeClose : false, // 点击遮罩关闭层
			area : [ '800px', '520px' ],
			content :  "/api/getvariant" // iframe的url
		});
	}
	// 删除变体
	function removeMyself(it){
		$this=$(it);
		$this.parent().remove();
		var shtml=$this.prev().html();
		$("#valueli li[data]").each(function(){
			if($(this).attr("data")==shtml){
				$(this).remove();
				return false;
			}
		})
		var array=new Array();
		array[0]="";
		diedai(0,array);
	}
	// 通过变体志迭代遍历所有变体组合
	function diedai(i,array){
		// 变体为空，重置变体组合列表
		if($("#valueli>li").length==0){
			$("#tbAdd").html("")
		}
		// 迭代次数等于迭代变体个数，迭代出口
		if(i==$("#valueli>li").length){
			return;
		}
		// 迭代拼接变态组合
		var arr=new Array()
		for (var int3 = 0; int3 < array.length; int3++) {
			for (var int2 = 0; int2 < $("#valueli>li").eq(i).children().eq(1).children().length; int2++){
				if(array.length==1&&array[0]===""){
					arr[arr.length]=array[int3]+$("#valueli>li").eq(i).children().eq(1).children().eq(int2).html();
				}else{
					arr[arr.length]=array[int3]+"-"+$("#valueli>li").eq(i).children().eq(1).children().eq(int2).html();
				}
			}
		}
		// 迭代次数等于迭代变体个数，返回所有变体组合
		if(i==$("#valueli>li").length-1){
			$sku=$("#piSku").val();
			// $piQuantity=$("#piQuantity").val();
			$("#tbAdd").html("");
			for (var int = 0; int < arr.length; int++) {
				$piQuantity=Math.round(Math.random()*10+50);
				var str='<tr><td><input onclick="onclikOneChecked()" type="checkbox"/></td><td >'+(int+1)+'</td><td class="com" width:"auto"><input type="hidden"  value="'+arr[int]+'">'+arr[int]+'</td><td><input  class="form-control skuClass updateskuget" type="text"  style="width:120px" readonly value="'+$sku+'-'+(int+1)+'"></td><td><input onchange="addprice(this)" class="form-control" type="text"></td><td><input  class="form-control" type="text"  value="'+$piQuantity+'"></td><td><input  class="form-control upceanclass" type="text"></td><td class="imgtd"></td></tr>'
				$("#tbAdd").append(str);
				i++;
			}
			/*
			* $('.com').each(function() { var $this = $(this); var text_length =
			* $this.width;//获取当前文本框的长度 if(text_length>200){
			* $this.css("width","100px"); } });
			*/
			/*
			* $('.skuClass').each(function() { var $this = $(this); var text_length =
			* $this.val().length;//获取当前文本框的长度 if(text_length>20){
			* $this.css("width","100px"); } });
			*/
		// 迭代次数小于迭代变体个数，返回所有变体组合
		}else{
			i++;
			diedai(i,arr);
		}
	}
	var tip;
	var layopenclo;
	// 弹出图片
	/*
	* $(document).click(function (e) { var drag = $("#imgdisplay"), dragel =
	* $("#imgdisplay")[0], target = e.target; if (dragel !== target &&
	* !$.contains(dragel, target)) { layer.close(layopenclo); } });
	*/
	function tipImg(it){
		if(isCheckFalse()&&$("li[data-ck='1']").length==0){
			layer.msg('请选择变体组合',{icon:5});
		}else{
			var tipid="#"+$(it).attr("id");
			$productUid=$("#productUid").val();
			console.log(tipid);
			console.log($productUid);
			$.ajax({
				type : "get",
				url : "/api/getproduct",
				data : {
                    cmd:"getVariantImages",
					dataid:$productUid
				},
				error : function(request) {
					parent.layer.alert("Connection error");
				},
				success : function(data) {
					console.log(data);
					var str="<div id='imgli'>"
					for (var i = 0; i < data.length; i++) {
						str+="<img data='"+data[i].uid+"' src='"+data[i].original+"' onclick='totd(this)' width='60' height='60' title='"+data[i].re_name+"'></img>"
					}
					str+="</div>"
					// $("#imgdisplay").html(str);
					// layopenclo=layer.open({
					// 	type: 1,
					// 	title: false,
					// 	shade: 0,
					// 	area : "300px",
					// 	content: $('#imgdisplay'),
					// 	offset: 'rb',
					// });
					tip=layer.tips(
						str,
						tipid,
						{
						tips: [1,'#fff'],
						time:false,
						closeBtn:[0,true] ,
						maxWidth:430,
						}
											
					);
				}
			})
		}
	};

	/*
	* document.onclick=function(){ if(tip!=null){ layer.close(tip); } }
	*/
	// 删除变体组合
	function deleC(){
		if(isCheckFalse()){
			layer.msg('请选择变体组合',{icon:5});
		}else{
			$("#vtable input[type=checkbox]:not(:first)").each(function(){
				if(this.checked){
					if(typeof($(this).parent().parent().next().html())!="undefined"){
						if($(this).parent().parent().next().html().indexOf("美国")!=-1){
							$(this).parent().parent().next().remove();
						}
					}
					$(this).parent().parent().remove();
				}
			})	
		}
		/*
		* var skuval=$("#piSku").val(); var tr=$('#tbAdd').children("tr"); var
		* tdarry=new Array(); for (var i = 0; i < tr.length; i++) { var
		* td=$(tr[i]).children("td");
		* if($(td[0]).find("input").attr("type")=="checkbox"){ tdarry.push(tr[i]); } }
		* $(".updateskuget").each(function(w){ var td=$(tdarry[w]).children("td");
		* var inpval=$(td[2]).find("input").val(); var inparr=inpval.split("-");
		* inparr[0]=skuval; $(td[2]).find("input").val(inparr[0]+"-"+(w+1)); })
		*/
	}

	function chooseColor(it){
		if($(it).attr("data-ck")=="1"){
			$(it).removeAttr("data-ck");
			$(it).css("background-color","");
		}else{
			var lis=$("li[data-ck='1']")
			if(lis!=null){
				lis.each(function(){
					$(this).removeAttr("data-ck");
					$(this).css("background-color","")
				})
				$(it).attr("data-ck","1");
				$(it).css("background-color","#4CAE4C");
			}
		
		}
		
		
	}
	// 将图片保存到td中
	function totd(it){
		$("#vtable input[type=checkbox]:not(:first)").each(function(){
			$td=$(this).parent().parent().children().last()
			if(this.checked){
				$td.append("<img data='"+$(it).attr("data")+"' src='"+$(it).attr("src")+"' onclick='deleteImg(this)' width='50' height='50'>");
			}
		})
		var lis=$("li[data-ck='1']")
		if(lis!=null){
			var str=lis.eq(0).html();
			// alert($("#vtable tr td:eq(2)").html());
			$(".com input").each(function(){
				$td=$(this).parent().parent().children().last()
				var arr = $(this).val().split('-');
				if($.inArray(str, arr)!=-1){
					$td.append("<img data='"+$(it).attr("data")+"' src='"+$(it).attr("src")+"' onclick='deleteImg(this)' width='50' height='50'>");
				}
			})
		}
	}
	// 点击删除图片
	function deleteImg(it){
		if(isCheckFalse()&&$("li[data-ck='1']").length==0){
			$(it).remove();
		}else{
			$("#vtable input[type=checkbox]:not(:first)").each(function(){
				if(this.checked){
					var tdchild=$(this).parent().parent().children();
					var imgs=$(tdchild[7]).find("img");
					for (var j = 0; j < imgs.length; j++) {
						if($(imgs[j]).attr("data")==$(it).attr("data")){
							$(imgs[j]).remove();
						}
					}
				}
			})
			var lis=$("li[data-ck='1']")
			if(lis!=null){
				var str=lis.eq(0).html();
				// alert($("#vtable tr td:eq(2)").html());
				$(".com input").each(function(){
					var arr = $(this).val().split('-');
					if($.inArray(str, arr)!=-1){
						var tdchild=$(this).parent().parent().children();
						var imgs=$(tdchild[7]).find("img");
						for (var j = 0; j < imgs.length; j++) {
							if($(imgs[j]).attr("data")==$(it).attr("data")){
								$(imgs[j]).remove();
							}
						}
					}	
				})
			}
		}
	// $(it).remove();
	}
	// 全选
	function checkAll(){
		$("#vtable input[type=checkbox]").each(function(){
			this.checked=true;
		})
	}
	// 全不选
	function checkFalseAll(){
		$("#vtable input[type=checkbox]").each(function(){
			$(this).attr("checked",false);
		})
	}
	// 点击全选方法
	function oclickAllChecked(it){
		if(it.checked){
			checkAll();
		}else {
			checkFalseAll();
		}
	}
	// 判断是否全选
	function isChecked(){
		var flag=true;
		$("#vtable input[type=checkbox]:not(:first)").each(function(){
			if(!this.checked){
				flag=false;
				return false;
			}
		})
		return flag;
	}
	// 判断是否全未选
	function isCheckFalse(){
		var flag=true;
		$("#vtable input[type=checkbox]:not(:first)").each(function(){
			if(this.checked){
				flag=false;
				return false;
			}
		})
		return flag;
	}
	// 单击每列复选框调用方法
	function onclikOneChecked(){
		if(isChecked()){
			$("#vtable input[type=checkbox]:first").get(0).checked=true;
		}else{
			$("#vtable input[type=checkbox]:first").attr("checked",false);
		}
	}
	// 初始化img列表
	function getImg(){
		$psoId=$("#psoId").val();
		$.ajax({
			type : "get",
			url : "/ymx/productPhoto/listJson",
			data : {"pphPid":$psoId,"sort":"pph_order","order":"asc"},// 你的formid
			error : function(request) {
				parent.layer.alert("Connection error");
			},
			success : function(data) {
				var str="";
				str+="<ul id='ul1'>";
					
				for (var int = 0; int < data.length; int++) {// ondblclick='deleteOrUpdate(this)'
					/*
					* str+="<li><img src='"+data[int].pphUrl+"' width='20'
					* height='150' />" + "<i class='fa fa-download fa-fw'
					* style='right: 82px;' onclick='downPhoto(this)'></i><i
					* class='fa fa-search fa-fw' style='right: 40px;'
					* onclick='searPhoto(this)'></i><span class='img_del'
					* onclick='delePhoto(this)'>X</span></li>"
					*/
					str+="<li>";
					str+="<div class='item' ondblclick='clickitemphoto(this)'>";
					str+="<img  src='"+data[int].pphUrl+"' id='"+data[int].pphPid+"'  data='"+data[int].pphId+"' order='"+data[int].pphOrder+"'/>";
					str+="<i class='fa fa-pencil fa-fw "+s_move_h+"' style='right: 166px;' onclick='xiuPhoto("+data[int].pphId+")'></i><i class='fa fa-upload fa-fw "+s_move_h+"' style='right: 124px;' onclick='movePhoto(this)'></i>";
					str+="<i class='fa fa-download fa-fw' style='right: 82px;' onclick='downPhoto(this)'></i><i class='fa fa-search fa-fw' style='right: 40px;' onclick='searPhoto(this)'></i><span class='img_del' onclick='delePhoto(this)'>X</span></li>";
					str+="</div>";
					str+="</li>";
				}
				str+="</ul>";
				$("#item_content-id").html(str);
				imgmove();
				var div = document.getElementById('item_content-id');
				var clientWidth = div.clientWidth;
				var height=Math.ceil(data.length/(Math.floor(clientWidth/220)));
				$("#item_content-id").attr("style","height:"+(height*230)+"px");
				// alert(document.getElementById('imgcol').clientWidth*2);
				/*
				* $("#ul1").attr("style","width:"+document.getElementById('imgdiv').clientWidth-document.getElementById('imgcol').clientWidth*2+"px");
				* //alert(Math.floor(clientWidth/220));
				*/
				
			}
		})
	}
	// 图片上传
	function uploadimg(){
		layui.use('upload', function () {
			var upload = layui.upload;
			// 执行实例
			var uploadInst = upload.render({
				elem: '#test1', // 绑定元素
				url: '/ymx/productPhoto/upload?pphPid='+$("#psoId").val(), // 上传接口
				multiple:true,
				accept: 'file',
				done: function (r) {
					parent.layer.msg("操作成功");
					getImg();
					/*
					* layer.msg(r.msg); app.getData();
					*/
				},
				error: function (r) {
					parent.layer.msg(r.msg)
					/* layer.msg(r.msg); */
				}
			});
		});
	}


	// 修改变体值
	function updateV(it){
		$pvaId=$(it).html();
		var str="";
		$("#valueli li[data]").each(function(){
			if($(this).attr("data")==$pvaId){
				$(this).find("ul").children().each(function(i){
					if(i==0){
						str+=$(this).html();
					}else{
						str+=","+$(this).html();
					}
				});
			}
		})
		layer.open({
			type : 2,
			title : '变体',
			maxmin : true,
			shadeClose : false, // 点击遮罩关闭层
			area : [ '800px', '520px' ],
			content :  "/ymx/productSource/editvalue?pvaName="+$pvaId+"&pvNames="+str+"&pvaid="+$(it).attr("data") // iframe的url
		});
	}

	function initbianti(){
		$psoId=$("#psoId").val();
		$.ajax({
			type : "get",
			url : "/ymx/productValue/listJson",
			data : {"piId":$psoId},// 你的formid
			error : function(request) {
				parent.layer.alert("Connection error");
			},
			success : function(data) {
				var str2=""
				for (var i = 0; i < data.length; i++) {
					str2+="<li><span class='sku_text' data='"+data[i].pvaId+"' onclick='updateV(this)'>"+data[i].pvaName+"</span><span class='close bt_del_skutype' onclick='removeMyself(this)'>x</span></li>";
					var $pvaId= data[i].pvaId;
					var $pvaName= data[i].pvaName;
					$.ajax({
						type : "get",
						url : "/ymx/productValue/listJson2",
						data : {
							"pvaId":$pvaId,
							"sort":"pv_id",
							"order":"asc",
							"piId":$psoId
						},
						async :false,
						error : function(request) {
							parent.layer.alert("Connection error");
						},
						success : function(data2) {
							var str="<li iddata='"+$pvaId+"' data='"+$pvaName+"'><span>"+$pvaName+': </span><ul>'
							for (var j = 0; j < data2.length; j++) {
									str+="<li onclick='chooseColor(this)'>"+data2[j].pvName+"</li>";
							}
							str+="</ul></li>";
							$("#valueli").append(str);
						}
					})
				}
				$("#sku").append(str2);
				
			}
		})
	}

	function parsing(){
		var source=$("#psoSource").val();
		var jsona=$("#jx").val();
		if(jsona!=null&&jsona!=''){
			var jsonObj = eval('(' + jsona + ')');
			if(source=="tmall"){
				for(var name in jsonObj){
					var json1=jsonObj[name];
					
					var str="<li  data='"+name+"'><span>"+name+': </span><ul>'
						for (var j = 0; j < json1.length; j++) {
								str+="<li>"+json1[j]+"</li>";
						}
						str+="</ul></li>";
						$("#valuejx").append(str);
				}

			}
			if(source=="taobao"){
				for(var name in jsonObj){
					var json1=jsonObj[name];
					
					var str="<li  data='"+name+"'><span>"+name+': </span><ul>'
						for (var j = 0; j < json1.length; j++) {
								str+="<li>"+json1[j]+"</li>";
						}
						str+="</ul></li>";
						$("#valuejx").append(str);
				}

			}
			if(source=="1688"){
				for(var name in jsonObj){
					var jsonObj1=jsonObj[name];
					
					for(var name1 in jsonObj1){
						var json2=jsonObj1[name1];
						for(var j = 0; j < json2.length; j++){
							var str="<li  data='"+json2[j].prop+"'><span>"+json2[j].prop+': </span><ul>'
							
							for (var i = 0; i < json2[j].value.length; i++) {
								
									str+="<li>"+json2[j].value[i].name+"</li>";
							}
							str+="</ul></li>";
							$("#valuejx").append(str);
						}
					}
					
				}

			}
			if(source=="amazon"){
				for(var name in jsonObj){
					var json1=jsonObj[name];
					
					var str="<li  data='"+name+"'><span>"+name+': </span><ul>'
						for (var j = 0; j < json1.length; j++) {
								str+="<li>"+json1[j]+"</li>";
						}
						str+="</ul></li>";
						$("#valuejx").append(str);
				}
			}
			if(source=="兰亭集势"){
				for(var name in jsonObj){
					var jsonObj1=jsonObj[name];
					var str="<li  data='"+name+"'><span>"+name+': </span><ul>'
					for(var name1 in jsonObj1){
							str+="<li>"+name1+"</li>";
					}
					str+="</ul></li>";
					$("#valuejx").append(str);
				}
			}
		}
		
	}
	function entranslation(obj){
		$.ajax({
			type : "POST",
			url : "/ymx/productTranslation/entranslation",
			data:{
				"to":obj,
				ptTitle:$("#title_en").val(),
				ptKeyword:$("#keywords_en").val(),
				ptPoint:$("#keypoints_en").val(),
				ptDesc:$("#description_en").val()
			},
			success : function(data) {
				$("#title_"+obj).val(data.ptTitle);
				$("#keywords_"+obj).val(data.ptKeyword);
				$("#keypoints_"+obj).val(data.ptPoint);
				$("#description_"+obj).val(data.ptDesc);
			}
		})
	}
	function translation(obj){
		$.ajax({
			type : "POST",
			url : "/ymx/productTranslation/translation",
			data:{
				"to":obj,
				ptTitle:$("#title_zh").val(),
				ptKeyword:$("#keywords_zh").val(),
				ptPoint:$("#keypoints_zh").val(),
				ptDesc:$("#description_zh").val()
			},
			success : function(data) {
				$("#title_"+obj).val(data.ptTitle);
				$("#keywords_"+obj).val(data.ptKeyword);
				$("#keypoints_"+obj).val(data.ptPoint);
				$("#description_"+obj).val(data.ptDesc);
			}
		})
		
		
	// $.ajax({
	// cache : true,
	// type : "POST",
	// url : "/ymx/productTranslation/translation",
	// data:{
	// languages:obj,
	// ptTitle:$("#title_zh").val(),
	// ptKeyword:$("#keywords_zh").val(),
	// ptPoint:$("#keypoints_zh").val(),
	// ptDesc:$("#description_zh").val()
	// },
	// async : false,
	// success : function(data) {
	//			
	// if(data.languages=="en"){
	// $("#title_en").val(data.ptTitle);
	// $("#keywords_en").val(data.ptKeyword);
	// $("#keypoints_en").val(data.ptPoint);
	// $("#description_en").val(data.ptDesc);
	// }
	// if(data.languages=="fr"){
	// $("#title_fr").val(data.ptTitle);
	// $("#keywords_fr").val(data.ptKeyword);
	// $("#keypoints_fr").val(data.ptPoint);
	// $("#description_fr").val(data.ptDesc);
	// }
	// if(data.languages=="de"){
	// $("#title_de").val(data.ptTitle);
	// $("#keywords_de").val(data.ptKeyword);
	// $("#keypoints_de").val(data.ptPoint);
	// $("#description_de").val(data.ptDesc);
	// }
	// if(data.languages=="it"){
	// $("#title_it").val(data.ptTitle);
	// $("#keywords_it").val(data.ptKeyword);
	// $("#keypoints_it").val(data.ptPoint);
	// $("#description_it").val(data.ptDesc);
	// }
	// if(data.languages=="es"){
	// $("#title_es").val(data.ptTitle);
	// $("#keywords_es").val(data.ptKeyword);
	// $("#keypoints_es").val(data.ptPoint);
	// $("#description_es").val(data.ptDesc);
	// }
	// if(data.languages=="ja"){
	// $("#title_ja").val(data.ptTitle);
	// $("#keywords_ja").val(data.ptKeyword);
	// $("#keypoints_ja").val(data.ptPoint);
	// $("#description_ja").val(data.ptDesc);
	// }
	// }
	// });
	}

	// 从中文一键翻译
	function translationList(){
		$("#label_lang_en").css("background-color","#4CAE4C");
		$("#label_lang_fr").css("background-color","#4CAE4C");
		$("#label_lang_de").css("background-color","#4CAE4C");
		$("#label_lang_it").css("background-color","#4CAE4C");
		$("#label_lang_es").css("background-color","#4CAE4C");
		$("#label_lang_ja").css("background-color","#4CAE4C");
		$.ajax({
	// cache : true,
			type : "POST",
			url : "/ymx/productTranslation/translationList",
			data:{
	// ptTitle:$("#title_en").val(),
	// ptKeyword:$("#keywords_en").val(),
	// ptPoint:$("#keypoints_en").val(),
	// ptDesc:$("#description_en").val()
				
				ptTitle:$("#title_zh").val(),
				ptKeyword:$("#keywords_zh").val(),
				ptPoint:$("#keypoints_zh").val(),
				ptDesc:$("#description_zh").val()
			},
	// async : false,
			success : function(data) {
				var title_zh=isnull($("#title_zh").val());// 判断中文标题是否为空;
				var keywords_zh=isnull($("#keywords_zh").val());// 判断中文关键字是否为空
				var keypoints_zh=isnull($("#keypoints_zh").val());// 判断中文要点是否为空
				var description_zh=isnull($("#description_zh").val());// 判断中文描述是否为空
				for(var i=0;i<data.length;i++){
					var traptTitle=data[i].ptTitle.replace("\\n","\n");
					var traptKeyword=data[i].ptKeyword.replace("\\n","\n");
					var traptPoint=data[i].ptPoint.replace("\\n","\n");
					var traptDesc=data[i].ptDesc.replace("\\n","\n");
					traptTitle = traptTitle.substring(0,1).toUpperCase()+traptTitle.substring(1);
					traptKeyword = traptKeyword.substring(0,1).toUpperCase()+traptKeyword.substring(1);
					traptPoint = traptPoint.substring(0,1).toUpperCase()+traptPoint.substring(1);
					traptDesc = traptDesc.substring(0,1).toUpperCase()+traptDesc.substring(1);
					if(data[i].languages=="en"){
						$("#title_en").val(traptTitle);
						$("#keywords_en").val(traptKeyword);
						$("#keypoints_en").val(traptPoint);
						$("#description_en").val(traptDesc);
						$("#label_lang_en").css("background-color","#FFFFFF");
						isChangeColor(title_zh,keywords_zh,keypoints_zh,description_zh,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_en");
					}
					if(data[i].languages=="fr"){
						$("#title_fr").val(traptTitle);
						$("#keywords_fr").val(traptKeyword);
						$("#keypoints_fr").val(traptPoint);
						$("#description_fr").val(traptDesc);
						$("#label_lang_fr").css("background-color","#FFFFFF");
						isChangeColor(title_zh,keywords_zh,keypoints_zh,description_zh,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_fr");
					}
					if(data[i].languages=="de"){
						$("#title_de").val(traptTitle);
						$("#keywords_de").val(traptKeyword);
						$("#keypoints_de").val(traptPoint);
						$("#description_de").val(traptDesc);
						$("#label_lang_de").css("background-color","#FFFFFF");
						isChangeColor(title_zh,keywords_zh,keypoints_zh,description_zh,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_de");
					}
					if(data[i].languages=="it"){
						$("#title_it").val(traptTitle);
						$("#keywords_it").val(traptKeyword);
						$("#keypoints_it").val(traptPoint);
						$("#description_it").val(traptDesc);
						$("#label_lang_it").css("background-color","#FFFFFF");
						isChangeColor(title_zh,keywords_zh,keypoints_zh,description_zh,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_it");
					}
					if(data[i].languages=="es"){
						$("#title_es").val(traptTitle);
						$("#keywords_es").val(traptKeyword);
						$("#keypoints_es").val(traptPoint);
						$("#description_es").val(traptDesc);
						$("#label_lang_es").css("background-color","#FFFFFF");
						isChangeColor(title_zh,keywords_zh,keypoints_zh,description_zh,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_es");
					}
					if(data[i].languages=="ja"){
						$("#title_ja").val(data[i].ptTitle.replace("\\n","\n"));
						$("#keywords_ja").val(data[i].ptKeyword.replace("\\n","\n"));
						$("#keypoints_ja").val(data[i].ptPoint.replace("\\n","\n"));
						$("#description_ja").val(data[i].ptDesc.replace("\\n","\n"));
						$("#label_lang_ja").css("background-color","#FFFFFF");
						isChangeColor(title_zh,keywords_zh,keypoints_zh,description_zh,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_ja");
					}
				}
			}
		});
	}
	// 从英文一键翻译
	function translationYingList(){
		$("#label_lang_fr").css("background-color","#4CAE4C");
		$("#label_lang_de").css("background-color","#4CAE4C");
		$("#label_lang_it").css("background-color","#4CAE4C");
		$("#label_lang_es").css("background-color","#4CAE4C");
		$("#label_lang_ja").css("background-color","#4CAE4C");
		$.ajax({
			// cache : true,
			type : "POST",
			url : "/ymx/productTranslation/translationYingList",
			data:{
				ptTitle:$("#title_en").val(),
				ptKeyword:$("#keywords_en").val(),
				ptPoint:$("#keypoints_en").val(),
				ptDesc:$("#description_en").val()
			},
			// async : false,
			success : function(data) {
				var title_en=isnull($("#title_en").val());// 判断英文标题是否为空;
				var keywords_en=isnull($("#keywords_en").val());// 判断英文关键字是否为空
				var keypoints_en=isnull($("#keypoints_en").val());// 判断英文要点是否为空
				var description_en=isnull($("#description_en").val());// 判断英文描述是否为空
				for(var i=0;i<data.length;i++){
					var traptTitle=data[i].ptTitle.replace("\\n","\n");
					var traptKeyword=data[i].ptKeyword.replace("\\n","\n");
					var traptPoint=data[i].ptPoint.replace("\\n","\n");
					var traptDesc=data[i].ptDesc.replace("\\n","\n");
					traptTitle = traptTitle.substring(0,1).toUpperCase()+traptTitle.substring(1);
					traptKeyword = traptKeyword.substring(0,1).toUpperCase()+traptKeyword.substring(1);
					traptPoint = traptPoint.substring(0,1).toUpperCase()+traptPoint.substring(1);
					traptDesc = traptDesc.substring(0,1).toUpperCase()+traptDesc.substring(1);
					if(data[i].languages=="fr"){
						$("#title_fr").val(traptTitle);
						$("#keywords_fr").val(traptKeyword);
						$("#keypoints_fr").val(traptPoint);
						$("#description_fr").val(traptDesc);
						$("#label_lang_fr").css("background-color","#FFFFFF");
						isChangeColor(title_en,keywords_en,keypoints_en,description_en,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_fr");
					}
					if(data[i].languages=="de"){
						$("#title_de").val(traptTitle);
						$("#keywords_de").val(traptKeyword);
						$("#keypoints_de").val(traptPoint);
						$("#description_de").val(traptDesc);
						$("#label_lang_de").css("background-color","#FFFFFF");
						isChangeColor(title_en,keywords_en,keypoints_en,description_en,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_de");
					}
					if(data[i].languages=="it"){
						$("#title_it").val(traptTitle);
						$("#keywords_it").val(traptKeyword);
						$("#keypoints_it").val(traptPoint);
						$("#description_it").val(traptDesc);
						$("#label_lang_it").css("background-color","#FFFFFF");
						isChangeColor(title_en,keywords_en,keypoints_en,description_en,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_it");
					}
					if(data[i].languages=="es"){
						$("#title_es").val(traptTitle);
						$("#keywords_es").val(traptKeyword);
						$("#keypoints_es").val(traptPoint);
						$("#description_es").val(traptDesc);
						$("#label_lang_es").css("background-color","#FFFFFF");
						isChangeColor(title_en,keywords_en,keypoints_en,description_en,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_es");
					}
					if(data[i].languages=="ja"){
						$("#title_ja").val(data[i].ptTitle.replace("\\n","\n"));
						$("#keywords_ja").val(data[i].ptKeyword.replace("\\n","\n"));
						$("#keypoints_ja").val(data[i].ptPoint.replace("\\n","\n"));
						$("#description_ja").val(data[i].ptDesc.replace("\\n","\n"));
						$("#label_lang_ja").css("background-color","#FFFFFF");
						isChangeColor(title_en,keywords_en,keypoints_en,description_en,traptTitle,traptKeyword,traptPoint,traptDesc,"#label_lang_ja");
					}
				}
			}
		});
	}

	var priceTable=new Array();
	// 成本运费
	function changePrice(obj){
		/*priceTable=new Array();
		var tr=$('#priceTbody').children("tr");
		for (var i = 0; i < tr.length; i++) {
			var td=$(tr[i]).children("td");
			var inp=new Object();
			inp[1]=$(td[1]).text();
			inp[2]="";
			priceTable.push(inp);
		}
		pricetableJson = encodeURI(JSON.stringify(priceTable));
		if($("#piWeight").valid()){
			$.ajax({
				type : "post",
				url : prefix+"/ymx/productInfo/changePrice",
				data : {
					"cmd":"changePrice",
					"piId":$("#psoId").val(),
					"piPrice":$("#piPrice").val(),
					"piWeight":$("#piWeight").val(),
					"piLong":$("#piLong").val(),
					"piWide":$("#piWide").val(),
					"piHigh":$("#piHigh").val(),
					"piFreight":$("#piFreight").val(),
					"piDiscount":$("#piDiscount").val(),
					"obj":obj,
					"pricetableJson" :pricetableJson,
				},
				error : function(request) {
					parent.layer.alert("Connection error");
				},
				success : function(data) {
					$("#priceTbody").html('');
					var str="";
					for (var i = 0; i < data.length; i++) {
						$("#priceTbody").append('<tr><td><span>'+data[i].cityName+'</span><input type="hidden" value="'+data[i].freId+'"></td><td><span>'+data[i].freFreight+'</span></td><td><span>'+data[i].frePrice+'</span></td>'
							+'<td><span>'+data[i].freCurrency+'</span>['+data[i].backup+']</td><td><input type="text"class="form-control" name="piUsprice" value="'+data[i].freFinal+'" onchange="freChange(this)"><input type="hidden" class="pricehid" value="'+data[i].bbackup+'"></td>'
							+'<td><span>'+data[i].freProfit+'</span>(<span>'+data[i].frePromargin+'</span>)</td></tr>')
					}
				}
			})
		}*/
	}

</script>
</html>